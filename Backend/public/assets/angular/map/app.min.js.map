{"version":3,"sources":["app.js"],"names":["runApp","$rootScope","$sce","cfpLoadingBar","apiService","$state","$timeout","mercadoPago","$transitions","root","inicio","foto","colorDefault","temaStorage","getStorage","cor","tema","replace","$on","openFoto","itensCarrinho","length","getInfoMercadoPago","email","post","then","res","parseInt","result","mercado_pago","loadMP","setAccessKey","loadConfig","redirect","go","dados","response","setStorage","configGeral","send","id","temaSalvar","banner","produto_id","listaPreco","empresa","$broadcast","err","auth","angularNotLoaded","loadingData","trustResource","html","trustAsHtml","trustUrl","url","trustAsResourceUrl","onStart","$transition","name","$to","formasPgMP","cliente","carrinho","start","mp","getPaymentsMethods","router","stateService","target","console","log","indexOf","onSuccess","complete","angular","module","run","$inject"],"mappings":"CAAA,WACE,YAeA,SAASA,GAAOC,EAAYC,EAAMC,EAAeC,EAAYC,EAAQC,EAAUC,EAAaC,GAC1F,GAAIC,GAAOR,CACXQ,GAAKC,QAAS,EACdD,EAAKE,MAAO,CAEZ,IAAIC,GAAe,SACnBH,GAAKI,YAAcT,EAAWU,WAAW,QACrCL,EAAKI,cACPD,EAAeH,EAAKI,YAAYE,IAElC,IAAIC,GAAO,8nCACXP,GAAKO,KAAOA,EAAKC,QAAQ,kBAAmBL,GAE5CH,EAAKS,IAAI,aAAc,WACrBT,EAAKI,YAAcT,EAAWU,WAAW,QACzCL,EAAKO,KAAOA,EAAKC,QAAQ,kBAAmBR,EAAKI,YAAYE,OAE/DN,EAAKU,SAAW,WACdb,EAAS,WACPG,EAAKE,MAAO,KAIhBF,EAAKW,cAAgBhB,EAAWU,WAAW,YAAcV,EAAWU,WAAW,YAAYO,OAAS,CAEpG,IAAIC,GAAqB,SAAUC,GACjC,MAAOnB,GAAWoB,KAAK,sBACrBD,MAASA,IACRE,KAAK,SAAUC,GAChB,GAA0C,IAAtCC,SAASD,EAAIE,OAAOC,cAKtB,MAJAtB,GAAYuB,SAASL,KAAK,WACxBlB,EAAYwB,iBAGPL,EAAIE,OAAOC,eAIxBpB,GAAKuB,WAAa,SAAUT,EAAOU,GACjC,IAAK7B,EAAWU,WAAW,QAEzB,WADAT,GAAO6B,GAAG,QAIZ,IAAIC,IACFZ,MAASA,EAEXnB,GACGoB,KAAK,SAAUW,GACfV,KAAK,SAAUC,GACdJ,EAAmBC,GAAOE,KAAK,SAAUW,GACvCV,EAAIE,OAAOC,aAAiBO,GAAsB,EAClDhC,EAAWiC,WAAW,OAAQX,EAAIE,QAClCU,EAAYL,MAEb,WACDK,EAAYL,KAGlB,IAAIK,GAAc,SAAUL,GAC1B,GAAIM,IACFC,GAAI,EAGNpC,GACGoB,KAAK,SAAUe,GACfd,KAAK,SAAUC,GACd,GAAIV,GAAOZ,EAAWU,WAAW,OAC5BE,KACHA,KAGF,IAAIyB,GAAaf,EAAIE,MACrBa,GAAWC,OAAS1B,EAAOA,EAAK0B,OAAS,KACzCD,EAAWE,WAAa3B,EAAOA,EAAK2B,WAAa,KACjDF,EAAWG,WAAa5B,EAAOA,EAAK4B,WAAa,KACjDH,EAAW1B,IAAMC,EAAOA,EAAKD,IAAM,KACnC0B,EAAWI,QAAU7B,EAAOA,EAAK6B,QAAU,KAC3CJ,EAAWZ,aAAeb,EAAOA,EAAKa,aAAe,EAErDzB,EAAWiC,WAAW,OAAQI,GAE9BhC,EAAKqC,WAAW,cAEZb,GACF5B,EAAO6B,GAAG,SAGX,SAAUa,OAIbC,EAAO5C,EAAWU,WAAW,OAC7BkC,IACFvC,EAAKuB,WAAWgB,EAAKzB,OAEvBd,EAAKwC,kBAAmB,EAExBxC,EAAKS,IAAI,mBAAoB,WAC3BT,EAAKyC,aAAc,IAGrBzC,EAAKS,IAAI,iBAAkB,WACzBT,EAAKyC,aAAc,IAErBzC,EAAK0C,cAAgB,SAAUC,GAC7B,MAAOlD,GAAKmD,YAAYD,IAG1B3C,EAAK6C,SAAW,SAAUC,GACxB,MAAOrD,GAAKsD,mBAAmBD,IAEjC/C,EAAaiD,WAAY,SAAUC,GACjC,GAAIC,GAAOD,EAAYE,MAAMD,KACzBX,EAAO5C,EAAWU,WAAW,QAC7B+C,EAAazD,EAAWU,WAAW,cACnCgD,EAAU1D,EAAWU,WAAW,WAChCiD,EAAW3D,EAAWU,WAAW,WAUrC,OARAX,GAAc6D,SAETH,GAActD,EAAY0D,MAC7B1D,EAAY2D,qBAAqBzC,KAAK,SAAUC,GAC9CtB,EAAWiC,WAAW,aAAcX,EAAIU,YAI/B,UAATuB,GAAoBX,EACfU,EAAYS,OAAOC,aAAaC,OAAO,QAEjC,UAATV,GAAqBX,GAK3BsB,QAAQC,KAAK,cAAe,YAAa,eAAeC,QAAQb,IAAS,GACzEW,QAAQC,IAAIT,IAEP,cAAe,YAAa,eAAeU,QAAQb,IAAS,IAAMG,EAC9DJ,EAAYS,OAAOC,aAAaC,OAAO,SACpC,YAAYG,QAAQb,IAAS,IAAMI,EACtCL,EAAYS,OAAOC,aAAaC,OAAO,YADzC,IATIX,EAAYS,OAAOC,aAAaC,OAAO,WAepD7D,EAAaiE,aAAc,SAAUf,GACnC,GAAIC,GAAOD,EAAYE,MAAMD,IAE7BrD,GAAS,WACPG,EAAKW,eAAiBhB,EAAWU,WAAW,iBAAmBO,SAGjEZ,EAAKC,QAAU,QAAS,QAAQ8D,QAAQb,IAAS,EAEjDxD,EAAcuE,aAxKlBC,QAAQC,OAAO,YACb,YACA,WACA,qBACA,sBACA,YACA,WAGFD,QAAQC,OAAO,YAAYC,IAAI7E,GAE/BA,EAAO8E,SAAW,aAAc,OAAQ,gBAAiB,aAAc,SAAU,WAAY,cAAe","file":"../app.min.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular.module('appToten', [\n    \"ui.router\",\n    \"ngLocale\",\n    \"LocalStorageModule\",\n    \"angular-loading-bar\",\n    \"ngAnimate\",\n    \"webcam\"\n  ]);\n\n  angular.module(\"appToten\").run(runApp);\n\n  runApp.$inject = ['$rootScope', '$sce', 'cfpLoadingBar', 'apiService', '$state', '$timeout', 'mercadoPago', '$transitions'];\n\n  function runApp($rootScope, $sce, cfpLoadingBar, apiService, $state, $timeout, mercadoPago, $transitions) {\n    var root = $rootScope;\n    root.inicio = true;\n    root.foto = false;\n\n    //region Tema\n    var colorDefault = \"#FF5B10\";\n    root.temaStorage = apiService.getStorage('tema');\n    if (root.temaStorage) {\n      colorDefault = root.temaStorage.cor;\n    }\n    var tema = \"header .logo:before, .btn, .categorias article .collumn .destaque .price, .categorias article h2:after, .produtos .filterRight li a:hover, .produtos .filterRight li a.active, header .meuCarrinho .img .notification, #loading-bar .bar, header ul li.active button, .carrinho .total div.cifra, .foto .closeModal{background: DEFAULTCOLOR}.home article h2, .produtos .listagem li .outer .total,.produto .infos .total,.carrinho .tableHolder table tbody tr td .preco,.choiceButton span:after,.cadastro .form-group label.required:after,.pagamento .obrigado h3,.pagamento .blocos ul li,.pagamento .blocos ul li .parcelas b,.pagamento .finalizacao h3,.pagamento .resumoCompra .tableHolder table tbody tr td span strong, .pagamento .resumoCompra .tableHolder table tbody tr td .preco, .pagamento .resumoCompra .tableHolder table tbody tr td:nth-child(1),.pagamento .resumoCompra .total div.number,.pagamento .resumoCompra h2,.pagamento .loginVendedor h3,.pagamento .loginVendedor .formField .input-group-addon {color: DEFAULTCOLOR}.carrinho .total div.field .btn.white, .carrinho .total div.field .number, .carrinho .total div.field ul li b{color:DEFAULTCOLOR}\";\n    root.tema = tema.replace(/(DEFAULTCOLOR)/g, colorDefault);\n\n    root.$on('temaLoaded', function () {\n      root.temaStorage = apiService.getStorage('tema');\n      root.tema = tema.replace(/(DEFAULTCOLOR)/g, root.temaStorage.cor);\n    });\n    //endregion\n\n    root.openFoto = function () {\n      $timeout(function () {\n        root.foto = true;\n      });\n    };\n\n//    apiService.delStorage('carrinho');\n\n    root.itensCarrinho = apiService.getStorage('carrinho') ? apiService.getStorage('carrinho').length : 0;\n\n    //region Load Config\n    var getInfoMercadoPago = function (email) {\n      return apiService.post('config/mercadoPago', {\n        \"email\": email\n      }).then(function (res) {\n        if (parseInt(res.result.mercado_pago) === 1) {\n          mercadoPago.loadMP().then(function () {\n            mercadoPago.setAccessKey();\n          });\n\n          return res.result.mercado_pago;\n        }\n      })\n    };\n    root.loadConfig = function (email, redirect) {\n      if (!apiService.getStorage('auth')) {\n        $state.go('login');\n        return;\n      }\n\n      var dados = {\n        \"email\": email\n      };\n      apiService\n        .post('config', dados)\n        .then(function (res) {\n          getInfoMercadoPago(email).then(function (response) {\n            res.result.mercado_pago = !!response ? response : 0;\n            apiService.setStorage('tema', res.result);\n            configGeral(redirect);\n          });\n        }, function () {\n          configGeral(redirect);\n        });\n    };\n    var configGeral = function (redirect) {\n      var send = {\n        id: 1\n      };\n\n      apiService\n        .post('config', send)\n        .then(function (res) {\n          var tema = apiService.getStorage('tema');\n          if (!tema) {\n            tema = {};\n          }\n\n          var temaSalvar = res.result;\n          temaSalvar.banner = tema ? tema.banner : null;\n          temaSalvar.produto_id = tema ? tema.produto_id : null;\n          temaSalvar.listaPreco = tema ? tema.listaPreco : null;\n          temaSalvar.cor = tema ? tema.cor : null;\n          temaSalvar.empresa = tema ? tema.empresa : null;\n          temaSalvar.mercado_pago = tema ? tema.mercado_pago : 0;\n\n          apiService.setStorage('tema', temaSalvar);\n\n          root.$broadcast('temaLoaded');\n\n          if (redirect) {\n            $state.go('home');\n          }\n\n        }, function (err) {\n        });\n\n    };\n    //endregion\n\n    //region LoadConfig() se tiver autorização\n    var auth = apiService.getStorage('auth');\n    if (auth) {\n      root.loadConfig(auth.email);\n    }\n    //endregion\n\n    //region Loading\n    root.angularNotLoaded = true;\n\n    root.$on('loading:progress', function () {\n      root.loadingData = true;\n    });\n\n    root.$on('loading:finish', function () {\n      root.loadingData = false;\n    });\n    //endregion\n\n    //region Utils\n    root.trustResource = function (html) {\n      return $sce.trustAsHtml(html);\n    };\n\n    root.trustUrl = function (url) {\n      return $sce.trustAsResourceUrl(url);\n    };\n    //endregion\n\n    //region Transitions\n    $transitions.onStart({}, function ($transition) {\n      var name = $transition.$to().name;\n      var auth = apiService.getStorage('auth');\n      var formasPgMP = apiService.getStorage('formasPgMP');\n      var cliente = apiService.getStorage('cliente');\n      var carrinho = apiService.getStorage('carrinho');\n\n      cfpLoadingBar.start();\n\n      if (!formasPgMP && mercadoPago.mp()) {\n        mercadoPago.getPaymentsMethods().then(function (res) {\n          apiService.setStorage('formasPgMP', res.response);\n        });\n      }\n\n      if (name === 'login' && auth) {\n        return $transition.router.stateService.target('home');\n      } else {\n        if (name !== 'login' && !auth) {\n          return $transition.router.stateService.target('login');\n        }\n      }\n\n      console.log(['finalizacao', 'pagamento', 'pagamentoMP'].indexOf(name) > -1);\n      console.log(cliente);\n\n      if (['finalizacao', 'pagamento', 'pagamentoMP'].indexOf(name) > -1 && !cliente) {\n        return $transition.router.stateService.target('home');\n      } else if (['cadastro'].indexOf(name) > -1 && !carrinho) {\n        return $transition.router.stateService.target('home');\n      }\n\n    });\n\n    $transitions.onSuccess({}, function ($transition) {\n      var name = $transition.$to().name;\n\n      $timeout(function () {\n        root.itensCarrinho = (apiService.getStorage('carrinho') || []).length;\n      });\n\n      root.inicio = [\"login\", \"home\"].indexOf(name) > -1;\n\n      cfpLoadingBar.complete();\n    });\n    //endregion\n  }\n\n})();\n\n"]}